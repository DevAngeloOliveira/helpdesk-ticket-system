# API Ticketing System - Exemplos de Requisi√ß√µes

## Base URL
http://localhost:8080/api

# ‚ö†Ô∏è IMPORTANTE: Autentica√ß√£o JWT
# Todas as rotas (exceto /api/auth/**) exigem autentica√ß√£o
# 1. Fa√ßa login em /api/auth/login
# 2. Copie o token retornado
# 3. Use o token no header Authorization: Bearer {token}

# ========================================
# VARI√ÅVEIS (substitua os valores)
# ========================================
@baseUrl = http://localhost:8080/api
@token = SEU_TOKEN_JWT_AQUI

---

## 0. AUTENTICA√á√ÉO (Endpoints P√∫blicos)

### Login - Admin
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "email": "admin@ticketsystem.com",
  "password": "admin123"
}

### Login - T√©cnico
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "email": "tech@ticketsystem.com",
  "password": "tech123"
}

### Login - Usu√°rio
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "email": "alice@example.com",
  "password": "user123"
}

### Registrar novo usu√°rio
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "name": "Novo Usu√°rio",
  "email": "novo@example.com",
  "password": "senha123",
  "role": "USER"
}

### Home (P√∫blico)
GET http://localhost:8080/

---

## 1. USERS (Usu√°rios) - REQUER JWT

### Listar todos os usu√°rios
GET {{baseUrl}}/users
Authorization: Bearer {{token}}

### Buscar usu√°rio por ID
GET {{baseUrl}}/users/1
Authorization: Bearer {{token}}

### Buscar usu√°rio por email
GET {{baseUrl}}/users/email/admin@ticketsystem.com
Authorization: Bearer {{token}}

### Criar novo usu√°rio
POST {{baseUrl}}/users
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Maria Silva",
  "email": "maria@example.com",
  "password": "senha123",
  "role": "USER"
}

### Atualizar usu√°rio
PUT {{baseUrl}}/users/1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Admin User Updated",
  "email": "admin@ticketsystem.com",
  "password": "admin123",
  "role": "ADMIN"
}

### Deletar usu√°rio
DELETE {{baseUrl}}/users/5
Authorization: Bearer {{token}}

---

## 2. STATUS - REQUER JWT

### Listar todos os status
GET {{baseUrl}}/statuses
Authorization: Bearer {{token}}

### Buscar status por ID
GET {{baseUrl}}/statuses/1
Authorization: Bearer {{token}}

### Criar novo status
POST {{baseUrl}}/statuses
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Pending"
}

### Atualizar status
PUT {{baseUrl}}/statuses/1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Open - Updated"
}

---

## 3. PRIORITIES (Prioridades) - REQUER JWT

### Listar todas as prioridades
GET {{baseUrl}}/priorities
Authorization: Bearer {{token}}

### Buscar prioridade por ID
GET {{baseUrl}}/priorities/1
Authorization: Bearer {{token}}

### Criar nova prioridade
POST {{baseUrl}}/priorities
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Urgent",
  "level": 0
}

### Atualizar prioridade
PUT {{baseUrl}}/priorities/1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Low Priority",
  "level": 4
}

---

## 4. CATEGORIES (Categorias) - REQUER JWT

### Listar todas as categorias
GET {{baseUrl}}/categories
Authorization: Bearer {{token}}

### Buscar categoria por ID
GET {{baseUrl}}/categories/1
Authorization: Bearer {{token}}

### Criar nova categoria
POST {{baseUrl}}/categories
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Database",
  "description": "Issues related to database systems"
}

### Atualizar categoria
PUT {{baseUrl}}/categories/1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Hardware Issues",
  "description": "All hardware related problems"
}

---

## 5. TICKETS (Chamados) - REQUER JWT

### Listar todos os chamados
GET {{baseUrl}}/tickets
Authorization: Bearer {{token}}

### Buscar chamado por ID
GET {{baseUrl}}/tickets/1
Authorization: Bearer {{token}}

### Chamados de um usu√°rio espec√≠fico
GET {{baseUrl}}/tickets/user/3
Authorization: Bearer {{token}}

### Chamados atribu√≠dos a um t√©cnico
GET {{baseUrl}}/tickets/assigned/2
Authorization: Bearer {{token}}

### Chamados por status
GET {{baseUrl}}/tickets/status/1
Authorization: Bearer {{token}}

### Criar novo chamado
# ‚ö†Ô∏è ATEN√á√ÉO: userId n√£o √© mais necess√°rio - obtido automaticamente do JWT
POST {{baseUrl}}/tickets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "title": "Sistema lento ap√≥s atualiza√ß√£o",
  "description": "Desde a √∫ltima atualiza√ß√£o do Windows, o sistema est√° muito lento. O computador demora mais de 5 minutos para iniciar.",
  "categoryId": 2,
  "priorityId": 2,
  "assignedToId": 2
}

### Atualizar chamado
# ‚ö†Ô∏è userId n√£o √© mais enviado no body
PUT {{baseUrl}}/tickets/1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "title": "Laptop not turning on - URGENT",
  "description": "My laptop won't start after the last update. Tried multiple times.",
  "categoryId": 1,
  "priorityId": 1,
  "assignedToId": 2
}

### Atualizar status do chamado (gera hist√≥rico)
PATCH {{baseUrl}}/tickets/status
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "ticketId": 1,
  "newStatusId": 3,
  "changedByUserId": 2
}

### Ver hist√≥rico de mudan√ßas de status
GET {{baseUrl}}/tickets/1/history
Authorization: Bearer {{token}}

### Deletar chamado
DELETE {{baseUrl}}/tickets/4
Authorization: Bearer {{token}}

---

## 6. COMMENTS (Coment√°rios) - REQUER JWT

### Listar coment√°rios de um chamado
GET {{baseUrl}}/comments/ticket/1
Authorization: Bearer {{token}}

### Buscar coment√°rio por ID
GET {{baseUrl}}/comments/1
Authorization: Bearer {{token}}

### Adicionar coment√°rio
POST {{baseUrl}}/comments
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "message": "J√° estou verificando o problema. Parece ser um driver de v√≠deo incompat√≠vel.",
  "ticketId": 1,
  "userId": 2
}

### Adicionar outro coment√°rio
POST {{baseUrl}}/comments
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "message": "Obrigado! Fico no aguardo da solu√ß√£o.",
  "ticketId": 1,
  "userId": 3
}

### Deletar coment√°rio
DELETE {{baseUrl}}/comments/1
Authorization: Bearer {{token}}

---

## 7. ATTACHMENTS (Anexos) - REQUER JWT

### Listar anexos de um chamado
GET {{baseUrl}}/attachments/ticket/1
Authorization: Bearer {{token}}

### Buscar anexo por ID
GET {{baseUrl}}/attachments/1
Authorization: Bearer {{token}}

### Adicionar anexo
POST {{baseUrl}}/attachments
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "fileName": "screenshot-error.png",
  "fileUrl": "https://storage.example.com/files/screenshot-error.png",
  "ticketId": 1
}

### Adicionar log file
POST {{baseUrl}}/attachments
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "fileName": "system-log.txt",
  "fileUrl": "https://storage.example.com/files/system-log.txt",
  "ticketId": 1
}

### Deletar anexo
DELETE {{baseUrl}}/attachments/1
Authorization: Bearer {{token}}

---

## 8. WORKFLOW COMPLETO - Exemplo de uso (COM JWT)

### PASSO 0: Fazer login e obter token
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "email": "admin@ticketsystem.com",
  "password": "admin123"
}

# ‚ö†Ô∏è COPIE o valor do campo "token" da resposta acima
# e substitua em todas as requisi√ß√µes abaixo onde est√° {{token}}

###

### 1. Criar usu√°rio t√©cnico
POST {{baseUrl}}/users
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Carlos Tech",
  "email": "carlos@tech.com",
  "password": "tech123",
  "role": "TECHNICIAN"
}

### 2. Criar usu√°rio comum
POST {{baseUrl}}/users
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Pedro Santos",
  "email": "pedro@example.com",
  "password": "user123",
  "role": "USER"
}

### 3. Usu√°rio abre chamado
POST {{baseUrl}}/tickets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "title": "Impressora n√£o responde",
  "description": "A impressora do setor financeiro n√£o est√° respondendo aos comandos de impress√£o",
  "userId": 5,
  "categoryId": 1,
  "priorityId": 2
}

### 4. Admin atribui chamado ao t√©cnico
PUT {{baseUrl}}/tickets/4
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "title": "Impressora n√£o responde",
  "description": "A impressora do setor financeiro n√£o est√° respondendo aos comandos de impress√£o",
  "userId": 5,
  "categoryId": 1,
  "priorityId": 2,
  "assignedToId": 4
}

### 5. T√©cnico muda status para "Em Progresso"
PATCH {{baseUrl}}/tickets/status
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "ticketId": 4,
  "newStatusId": 2,
  "changedByUserId": 4
}

### 6. T√©cnico adiciona coment√°rio
POST {{baseUrl}}/comments
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "message": "Verificando a conex√£o de rede da impressora",
  "ticketId": 4,
  "userId": 4
}

### 7. T√©cnico adiciona evid√™ncia (screenshot)
POST {{baseUrl}}/attachments
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "fileName": "printer-config.jpg",
  "fileUrl": "https://storage.example.com/printer-config.jpg",
  "ticketId": 4
}

### 8. T√©cnico resolve o chamado
PATCH {{baseUrl}}/tickets/status
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "ticketId": 4,
  "newStatusId": 3,
  "changedByUserId": 4
}

### 9. T√©cnico adiciona solu√ß√£o
POST {{baseUrl}}/comments
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "message": "Problema resolvido. O cabo de rede estava solto. Reconectei e testei com sucesso.",
  "ticketId": 4,
  "userId": 4
}

### 10. Usu√°rio confirma e fecha chamado
PATCH {{baseUrl}}/tickets/status
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "ticketId": 4,
  "newStatusId": 4,
  "changedByUserId": 5
}

### 11. Ver todo o hist√≥rico do chamado
GET {{baseUrl}}/tickets/4/history
Authorization: Bearer {{token}}

---

## üìù COMO USAR ESTE ARQUIVO

### Op√ß√£o 1: VS Code REST Client Extension
1. Instale a extens√£o "REST Client" no VS Code
2. Abra este arquivo `.http`
3. Clique em "Send Request" acima de cada requisi√ß√£o
4. Para usar vari√°veis:
   - Edite a se√ß√£o de vari√°veis no topo
   - Substitua `{{token}}` pelo token JWT real ap√≥s o login

### Op√ß√£o 2: Manualmente (cURL)
```bash
# 1. Fa√ßa login
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@ticketsystem.com","password":"admin123"}'

# 2. Copie o token da resposta

# 3. Use em outras requisi√ß√µes
curl -X GET http://localhost:8080/api/users \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

### Op√ß√£o 3: Postman
1. Importe este arquivo como cole√ß√£o
2. Configure vari√°veis de ambiente:
   - `baseUrl`: http://localhost:8080/api
   - `token`: (obtenha fazendo login)
3. Use `{{baseUrl}}` e `{{token}}` nas requisi√ß√µes

---

## üîê CREDENCIAIS PADR√ÉO

| Nome           | Email                   | Senha    | Role       |
|----------------|-------------------------|----------|------------|
| Admin User     | admin@ticketsystem.com  | admin123 | ADMIN      |
| John Technician| tech@ticketsystem.com   | tech123  | TECHNICIAN |
| Alice Johnson  | alice@example.com       | user123  | USER       |
| Bob Smith      | bob@example.com         | user123  | USER       |

---

## ‚úÖ Valida√ß√µes implementadas

- Email deve ser √∫nico
- Senha m√≠nima de 6 caracteres
- T√≠tulo do chamado: 5-200 caracteres
- Descri√ß√£o do chamado: m√≠nimo 10 caracteres
- Campos obrigat√≥rios validados automaticamente
- JWT expira em 24 horas

---

## ‚ö†Ô∏è IMPORTANTE

1. **Autentica√ß√£o obrigat√≥ria**: Todas as rotas (exceto `/api/auth/**`) exigem token JWT
2. **Token no header**: Sempre inclua `Authorization: Bearer {token}`
3. **Renova√ß√£o**: Fa√ßa login novamente se o token expirar (24h)
4. **Endpoints p√∫blicos**: 
   - `POST /api/auth/login`
   - `POST /api/auth/register`
   - `GET /`
   - `GET /h2-console/**`

---

## 6. COMMENTS (Coment√°rios)

### Listar coment√°rios de um chamado
GET http://localhost:8080/api/comments/ticket/1

### Buscar coment√°rio por ID
GET http://localhost:8080/api/comments/1

### Adicionar coment√°rio
POST http://localhost:8080/api/comments
Content-Type: application/json

{
  "message": "J√° estou verificando o problema. Parece ser um driver de v√≠deo incompat√≠vel.",
  "ticketId": 1,
  "userId": 2
}

### Adicionar outro coment√°rio
POST http://localhost:8080/api/comments
Content-Type: application/json

{
  "message": "Obrigado! Fico no aguardo da solu√ß√£o.",
  "ticketId": 1,
  "userId": 3
}

### Deletar coment√°rio
DELETE http://localhost:8080/api/comments/1

---

## 7. ATTACHMENTS (Anexos)

### Listar anexos de um chamado
GET http://localhost:8080/api/attachments/ticket/1

### Buscar anexo por ID
GET http://localhost:8080/api/attachments/1

### Adicionar anexo
POST http://localhost:8080/api/attachments
Content-Type: application/json

{
  "fileName": "screenshot-error.png",
  "fileUrl": "https://storage.example.com/files/screenshot-error.png",
  "ticketId": 1
}

### Adicionar log file
POST http://localhost:8080/api/attachments
Content-Type: application/json

{
  "fileName": "system-log.txt",
  "fileUrl": "https://storage.example.com/files/system-log.txt",
  "ticketId": 1
}

### Deletar anexo
DELETE http://localhost:8080/api/attachments/1

---

## 8. WORKFLOW COMPLETO - Exemplo de uso

### 1. Criar usu√°rio t√©cnico
POST http://localhost:8080/api/users
Content-Type: application/json

{
  "name": "Carlos Tech",
  "email": "carlos@tech.com",
  "password": "tech123",
  "role": "TECHNICIAN"
}

### 2. Criar usu√°rio comum
POST http://localhost:8080/api/users
Content-Type: application/json

{
  "name": "Pedro Santos",
  "email": "pedro@example.com",
  "password": "user123",
  "role": "USER"
}

### 3. Usu√°rio abre chamado
POST http://localhost:8080/api/tickets
Content-Type: application/json

{
  "title": "Impressora n√£o responde",
  "description": "A impressora do setor financeiro n√£o est√° respondendo aos comandos de impress√£o",
  "userId": 5,
  "categoryId": 1,
  "priorityId": 2
}

### 4. Admin atribui chamado ao t√©cnico
PUT http://localhost:8080/api/tickets/4
Content-Type: application/json

{
  "title": "Impressora n√£o responde",
  "description": "A impressora do setor financeiro n√£o est√° respondendo aos comandos de impress√£o",
  "userId": 5,
  "categoryId": 1,
  "priorityId": 2,
  "assignedToId": 4
}

### 5. T√©cnico muda status para "Em Progresso"
PATCH http://localhost:8080/api/tickets/status
Content-Type: application/json

{
  "ticketId": 4,
  "newStatusId": 2,
  "changedByUserId": 4
}

### 6. T√©cnico adiciona coment√°rio
POST http://localhost:8080/api/comments
Content-Type: application/json

{
  "message": "Verificando a conex√£o de rede da impressora",
  "ticketId": 4,
  "userId": 4
}

### 7. T√©cnico adiciona evid√™ncia (screenshot)
POST http://localhost:8080/api/attachments
Content-Type: application/json

{
  "fileName": "printer-config.jpg",
  "fileUrl": "https://storage.example.com/printer-config.jpg",
  "ticketId": 4
}

### 8. T√©cnico resolve o chamado
PATCH http://localhost:8080/api/tickets/status
Content-Type: application/json

{
  "ticketId": 4,
  "newStatusId": 3,
  "changedByUserId": 4
}

### 9. T√©cnico adiciona solu√ß√£o
POST http://localhost:8080/api/comments
Content-Type: application/json

{
  "message": "Problema resolvido. O cabo de rede estava solto. Reconectei e testei com sucesso.",
  "ticketId": 4,
  "userId": 4
}

### 10. Usu√°rio confirma e fecha chamado
PATCH http://localhost:8080/api/tickets/status
Content-Type: application/json

{
  "ticketId": 4,
  "newStatusId": 4,
  "changedByUserId": 5
}

### 11. Ver todo o hist√≥rico do chamado
GET http://localhost:8080/api/tickets/4/history

---

## Dicas de uso:

1. **VS Code**: Instale a extens√£o "REST Client" para executar essas requisi√ß√µes diretamente
2. **Postman**: Importe como cole√ß√£o
3. **cURL**: Converta para comandos curl conforme necess√°rio
4. **Insomnia**: Importe o arquivo

## Valida√ß√µes implementadas:

- Email deve ser √∫nico
- Senha m√≠nima de 6 caracteres
- T√≠tulo do chamado: 5-200 caracteres
- Descri√ß√£o do chamado: m√≠nimo 10 caracteres
- Campos obrigat√≥rios validados automaticamente
